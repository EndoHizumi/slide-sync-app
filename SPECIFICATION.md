# スライド同期アプリケーション仕様書

## 1. システム概要

PDFスライドをWebブラウザで表示し、複数の閲覧者間でページ同期を行うWebアプリケーション。
プレゼンター（ホスト）とオーディエンス（ゲスト）の役割分担により、効率的な遠隔プレゼンテーションを実現します。

## 2. システム構成

### 2.1 フロントエンド
- HTML/CSS/JavaScript
- PDF.js: PDFファイルの表示
- WebSocket: リアルタイム通信

### 2.2 バックエンド
- Node.js/Express: Webサーバー
- ws: WebSocketサーバー

## 3. ロール管理システム

### 3.1 ホスト（プレゼンター）
- 権限
  - PDFファイルのアップロード
  - ページ送り/戻し操作
  - 全ゲストへのページ同期制御

- 機能制限
  - 1セッションにつき1ホストのみ許可
  - 他のホストが接続中の場合は接続不可

### 3.2 ゲスト（オーディエンス）
- 権限
  - PDFスライドの閲覧
  - ホストの操作に自動追従

- 機能制限
  - PDFファイルのアップロード不可
  - ページ操作不可
  - 複数接続可能

## 4. ロール識別の仕組み

### 4.1 ロール選択
- 画面上部のドロップダウンメニューでロールを選択
- 選択可能なロール
  - ホスト（Host）
  - ゲスト（Guest）

### 4.2 WebSocket接続管理
1. クライアントがWebSocket接続を確立
2. 接続直後に選択したロールをサーバーに通知
   ```javascript
   {
     type: 'register',
     role: 'host' | 'guest'
   }
   ```
3. サーバーサイドでロールに応じた接続管理
   - ホスト接続をSet型で管理
   - ゲスト接続を別のSet型で管理
   - 各クライアントにroleプロパティを付与

## 5. 同期の仕組み

### 5.1 ページ同期フロー
1. ホストがページを変更
2. WebSocketでサーバーに通知
   ```javascript
   {
     type: 'page',
     page: currentPage
   }
   ```
3. サーバーが全ゲストに新しいページ番号を配信
4. ゲストのPDFビューアーが自動的に該当ページを表示

### 5.2 新規ゲスト接続時
1. ゲストが接続
2. サーバーが現在のページ番号を送信
3. ゲストが最新のページを表示

## 6. エラーハンドリング

### 6.1 接続エラー
- WebSocket接続が切断された場合、自動再接続を試行
- 再接続時に最新のページ状態を同期

### 6.2 ロール関連エラー
- ホストが既に存在する場合、新規ホスト接続を拒否
- ホスト切断時、ゲストに通知

## 7. モバイル対応

### 7.1 レスポンシブデザイン
- ビューポート対応
- フレキシブルなPDFビューアーサイズ
- タッチ操作対応

### 7.2 画面サイズ別の最適化
- デスクトップ（> 1024px）
- タブレット（768px - 1024px）
- モバイル（< 768px）